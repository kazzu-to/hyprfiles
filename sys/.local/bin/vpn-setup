#!/usr/bin/env bash

# ================== COLORS ==================
RED=$'\033[0;31m'
GREEN=$'\033[0;32m'
YELLOW=$'\033[1;33m'
NC=$'\033[0m'

# ================== SCRIPT ==================
sudo pacman -S wireguard-tools networkmanager --needed --noconfirm

cfg="$1"

if [[ -z $cfg ]]; then
    echo -e "${YELLOW}Usage: vpn-setup <wireguard-config.conf>${NC}"
    exit 1
fi

# Expand leading ~ (Bash will NOT do this for variables)
if [[ $cfg == "~/"* ]]; then
    cfg="$HOME/${cfg#~/}"
elif [[ $cfg == "~" ]]; then
    cfg="$HOME"
fi

if [[ ! -f "$cfg" ]]; then
    echo -e "${RED}❌ File not found: $cfg${NC}"
    exit 1
fi

sudo cp -- "$cfg" /etc/wireguard/
conf="$(basename -- "$cfg" .conf)"

sudo systemctl enable --now "wg-quick@$conf.service"
sudo nmcli connection import type wireguard file "/etc/wireguard/$conf.conf"

echo -e "${GREEN}✅ Added WireGuard VPN and imported into NetworkManager${NC}"

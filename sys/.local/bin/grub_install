#!/usr/bin/env bash

function error {
	if [[ $? -ne 0 ]]; then
		echo $2
		exit $1
	fi
}

if ! [[ -s "/usr/bin/grub-install" ]]; then
	echo "grub not installed"
	exit 1 
fi 

grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB
error 2 "grub-install not successfull"

grub-mkconfig -o /boot/grub/grub.cfg
error 3 "grub-mkconfig not successfull"

sed -i "s/GRUB_TIMEOUT=/GRUB_TIMEOUT=10/g" "/etc/default/grub" 2>/dev/null
error 4 "unable to set grub timeout"
sed -i "s/GRUB_DEFAULT=/GRUB_DEFAULT=\"saved\"/g" "/etc/default/grub" 2>/dev/null
error 5 "unable to set grub default as saved"
sed -i "s/GRUB_DISABLE_OS_PROBER=/GRUB_DISABLE_OS_PROBER=false/g" "/etc/default/grub" 2>/dev/null
error 6 "unable to enable os prober"
sed -i "s/GRUB_THEME/GRUB_THEME=\"\/boot\/grub\/themes\/poly-dark\/theme.txt\"/g" "/etc/default/grub" 2>/dev/null
error 7 "unable to set grub theme"
sed -i "s/GRUB_BACKGROUND/GRUB_BACKGROUND=\"\/boot\/grub\/themes\/poly-dark\/grub.png\"/g" "/etc/default/grub" 2>/dev/null
error 8 "unable to set grub background"

grub-mkconfig -o /boot/grub/grub.cfg
error 9 "Unable to update grub"
